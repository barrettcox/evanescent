"use strict";var Temporal=Temporal||{};Temporal.App=function(a){return{init:function(){var b=this,c={invitee:a("#temporal-invitee"),timer:a("#temporal-timer"),triggerSelector:"[data-temporal-trigger]"};for(var d in c)"undefined"==typeof b[d]&&(b[d]=c[d]);b.invitee.length&&(b.username=b.invitee.attr("data-temporal-username"),b.gateName=b.invitee.attr("data-temporal-gate-name"),b.gateId=b.invitee.attr("data-temporal-gate"),b.url=b.invitee.attr("data-temporal-url"),b.ajaxCheckTime(!0)),a(document).on("click",b.triggerSelector,function(c){c.preventDefault();var d=a(this).attr("data-temporal-gate")||b.gateId;b.startSecondaryTimer(d)})},zeroPad:function(a,b){var c="0"+a;return c.substr(c.length-b)},getHMS:function(a){var b=this,c=a/3600,d=Math.floor(c),e=c%1,f=60*e,g=Math.floor(f),h=f%1,i=Math.floor(60*h),j=d+"",k=b.zeroPad(g,2),l=b.zeroPad(i,2),m=j+":"+k+":"+l;return m},ajaxCheckTime:function(b){var b="undefined"!=typeof b&&b,c=this;a.ajax({url:frontendajax.ajaxurl,data:{action:"temporal_ajax_check_time",username:c.username,gate:c.gateId},success:function(a){if("expired"==a)window.location.href=c.url;else try{var d=JSON.parse(a);b&&(d.secondary&&c.timer.not(":visible")&&c.timer.show(),c.timer.attr("data-temporal-remaining",d.remaining),c.startInterval(d.secondary))}catch(e){console.log("Problem with JSON object: "),console.log(a)}},error:function(a){console.log(a)}})},startInterval:function(a){var b=this,c=0;"undefined"!=typeof b.timeCheckInterval&&clearInterval(b.timeCheckInterval),b.timeCheckInterval=setInterval(function(){console.log("interval");var d=b.timer;if(a)if(d.length){var e=d.attr("data-temporal-remaining");e=parseInt(e)-1,e||b.ajaxCheckTime();var f=b.getHMS(e);d.attr("data-temporal-remaining",e),d.is(":visible")&&d.children(".temporal-timer__time").html(f),c%10==0&&b.ajaxCheckTime()}else window.location.href=b.url;c++},1e3)},startSecondaryTimer:function(b){console.log("gateId:"),console.log(b);var c=this,b=b||c.gateId;a.ajax({url:frontendajax.ajaxurl,data:{action:"temporal_ajax_init_secondary",username:c.username,gate:b},success:function(a){console.log(a),"success"==a&&c.ajaxCheckTime(!0)},error:function(a){console.log(a)}})}}}(jQuery),jQuery(document).ready(function(a){var b=Temporal.App;b.init()});