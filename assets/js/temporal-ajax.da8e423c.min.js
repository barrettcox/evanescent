"use strict";var Temporal=Temporal||{};Temporal.App=function(n){return{init:function(){var a=this,e={invitee:n("#temporal-invitee"),timer:n("#temporal-timer"),triggerSelector:"[data-temporal-trigger]"};for(var t in e)void 0===a[t]&&(a[t]=e[t]);a.invitee.length&&(a.username=a.invitee.attr("data-temporal-username"),a.gateName=a.invitee.attr("data-temporal-gate-name"),a.gateId=a.invitee.attr("data-temporal-gate"),a.url=a.invitee.attr("data-temporal-url"),a.ajaxCheckTime(!0)),n(document).on("click",a.triggerSelector,function(e){e.preventDefault();var t=n(this).attr("data-temporal-gate")||a.gateId;a.startSecondaryTimer(t)})},zeroPad:function(e,t){var a="0"+e;return a.substr(a.length-t)},getHMS:function(e){var t=e/3600,a=Math.floor(t),r=60*(t%1),n=Math.floor(r),i=r%1,o=Math.floor(60*i);return a+""+":"+this.zeroPad(n,2)+":"+this.zeroPad(o,2)},ajaxCheckTime:function(a){a=void 0!==a&&a;var r=this;n.ajax({url:frontendajax.ajaxurl,data:{action:"temporal_ajax_check_time",username:r.username,gate:r.gateId},success:function(t){if("expired"==t)window.location.href=r.url;else try{var e=JSON.parse(t);a&&(e.secondary&&r.timer.not(":visible")&&r.timer.show(),r.timer.attr("data-temporal-remaining",e.remaining),r.startInterval(e.secondary))}catch(e){console.log("Problem with JSON object: "),console.log(t)}},error:function(e){console.log(e)}})},startInterval:function(r){var n=this,i=0;void 0!==n.timeCheckInterval&&clearInterval(n.timeCheckInterval),n.timeCheckInterval=setInterval(function(){console.log("interval");var e=n.timer;if(r)if(e.length){var t=e.attr("data-temporal-remaining");(t=parseInt(t)-1)||n.ajaxCheckTime();var a=n.getHMS(t);e.attr("data-temporal-remaining",t),e.is(":visible")&&e.children(".temporal-timer__time").html(a),i%10==0&&n.ajaxCheckTime()}else window.location.href=n.url;i++},1e3)},startSecondaryTimer:function(e){console.log("gateId:"),console.log(e);var t=this;e=e||t.gateId;n.ajax({url:frontendajax.ajaxurl,data:{action:"temporal_ajax_init_secondary",username:t.username,gate:e},success:function(e){console.log(e),"success"==e&&t.ajaxCheckTime(!0)},error:function(e){console.log(e)}})}}}(jQuery),jQuery(document).ready(function(e){Temporal.App.init()});